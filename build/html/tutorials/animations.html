<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating an animation using Emperor &#8212; Emperor 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Integrating Emperor’s JavaScript API with other applications" href="../js_integration.html" />
    <link rel="prev" title="File Formats" href="../formats.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head>
  <body role="document">
  
  <a href="https://github.com/biocore/emperor"
     class="visible-desktop hidden-xs"><img
    id="gh-banner"
    style="position: absolute; top: 50px; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
    alt="Fork me on GitHub"></a>
  <script>
    // Adjust banner height.
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
  </script>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Emperor</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../emperor_objects.html">Emperor&#8217;s public API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats.html">File Formats</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating an animation using Emperor</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../js_integration.html">Integrating Emperor&#8217;s JavaScript API with other applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js_integration.html#subscribing-to-events-from-a-3rd-party-application">Subscribing to Events from a 3rd Party application</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Creating an animation using Emperor</a><ul>
<li><a class="reference internal" href="#synthetic-example">Synthetic Example</a><ul>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#processing">Processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#real-example">Real Example</a><ul>
<li><a class="reference internal" href="#id1">Data</a></li>
<li><a class="reference internal" href="#id2">Processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#filtering-out-data">Filtering out data</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <span class="target" id="animations"></span><div class="section" id="creating-an-animation-using-emperor">
<span id="index-0"></span><h1>Creating an animation using Emperor<a class="headerlink" href="#creating-an-animation-using-emperor" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we describe how to create a principal coordinates analysis
(PCoA) plot, and display animated traces of the samples sorted by a metadata
category. For this purpose, we will describe a <cite>Synthetic Example</cite> (explaining
concepts) and a <cite>Real Example</cite> (that deals with the actual plot generation, and
curation).</p>
<p>To do this, we need to have two metadata categories, a <em>gradient</em> category, and
a <em>trajectory</em> category. The <em>gradient</em> category determines the order in which
samples are connected together, the <em>trajectory</em> category determines how
samples are grouped together.</p>
<div class="section" id="synthetic-example">
<h2>Synthetic Example<a class="headerlink" href="#synthetic-example" title="Permalink to this headline">¶</a></h2>
<p>In most cases the <em>trajectory</em> and <em>gradient</em> columns already exist as part of
your sample information, however you may need to do some curation to make these
compatible with Emperor.</p>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>In this example, consider a longitudinal study where you wish to track the oral
microbiome changes in a cohort of 3 mice over the course of 5 weeks, each
sample will be described by the following columns:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cage_number</span></code>: the cage where each mice was housed, more than one mice could
have resided in the same cage.</li>
<li><code class="docutils literal"><span class="pre">age_in_years</span></code>: the age of each mice in years.</li>
<li><code class="docutils literal"><span class="pre">week</span></code>: the number of the week in this experiment.</li>
<li><code class="docutils literal"><span class="pre">sex</span></code>: the sex of each mice.</li>
<li><code class="docutils literal"><span class="pre">mice_identifier</span></code>: where each mice is assigned a unique identifier.</li>
</ul>
</div>
<div class="section" id="processing">
<h3>Processing<a class="headerlink" href="#processing" title="Permalink to this headline">¶</a></h3>
<p>Here, we can use the <code class="docutils literal"><span class="pre">week</span></code> column as our <em>gradient</em> category, so as long as
all the values are numerical. To be more precise, a column where values were
indicated as <code class="docutils literal"><span class="pre">pre-treatment,</span> <span class="pre">first,</span> <span class="pre">second,</span> <span class="pre">third</span> <span class="pre">and</span> <span class="pre">last</span></code> would not be
appropriate and instead would need to be converted into (for example): <code class="docutils literal"><span class="pre">-1,</span> <span class="pre">1,</span>
<span class="pre">2,</span> <span class="pre">3</span> <span class="pre">and</span> <span class="pre">4</span></code> (remember we have 5 weeks of data).</p>
<p>As for the <em>trajectory</em> category, the natural choice would be to use the
<code class="docutils literal"><span class="pre">mice_identifier</span></code> column, because it uniquely identifies every mice, and
should be the same throughout the experiment.</p>
<p>All the remaining columns (<code class="docutils literal"><span class="pre">cage_number</span></code>, <code class="docutils literal"><span class="pre">age_in_years</span></code> and <code class="docutils literal"><span class="pre">sex</span></code>), are
not explicitly needed to create an animation, but can be used to change the
color, visibility and size of the samples.</p>
<p>The following figure shows what we expect to observe when we press the play
button (week numbers are only showed as a reference).</p>
<div class="figure" id="id3">
<img alt="Cartoon representation of the example above." src="../_images/trajectories.png" />
<p class="caption"><span class="caption-text">Cartoon representation of the synthetic example. On the left, the unmodified
ordination coloring samples by mice. On the center, the same ordination with
a label for each sample, corresponding to the week where this sample was
collected. On the right, samples connected by a line, where the order is
determined by the collection time (all trajectories begin at <code class="docutils literal"><span class="pre">-1</span></code>).</span></p>
</div>
<p>From the trajectories, you can see that samples are connected according to the
numerical order in the <em>gradient</em> category, and that missing data is simply
ignored, for example the red samples are missing timepoint <code class="docutils literal"><span class="pre">2</span></code>, therefore
sample <code class="docutils literal"><span class="pre">1</span></code> is connected to sample <code class="docutils literal"><span class="pre">3</span></code>.</p>
<p>In the next section we will go through an example using published data from
<a class="reference external" href="https://www.ncbi.nlm.nih.gov/pubmed/25825673">Weingarden et al. 2015</a>.</p>
</div>
</div>
<div class="section" id="real-example">
<h2>Real Example<a class="headerlink" href="#real-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Data<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>This example will help us visualize the short and long-term changes of four
patients as they undergo a fecal material transplant (FMT).  To contextualize
these changes, we are going to use the data from the Human Microbiome Project
(HMP), an initiative that characterized the microbial communities of 252
<strong>healthy</strong> human adults in four different supersites (fecal, skin, oral and
vaginal communities).</p>
<p>For convenience, we combined the two datasets using <a class="reference external" href="https://qiita.ucsd.edu">Qiita</a>. Specifically the studies we used are <a class="reference external" href="https://qiita.ucsd.edu/study/description/10057">study 10057</a> (FMT) and <a class="reference external" href="https://qiita.ucsd.edu/study/description/1928">study 1928</a> (HMP). Remember you need to
be logged in to access the studies.</p>
<p>The files needed for this tutorial can be downloaded from this <a class="reference external" href="http://emperor.microbio.me/q2-animations/q2-animations-tutorial.zip">link</a>.</p>
</div>
<div class="section" id="id2">
<h3>Processing<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>As discussed before, we will need to identify two columns that allow us to sort
samples, and to group them. We only want to focus on the observed changes in
the microbiome of patients that undergo an FMT, therefore the subjects from the
HMP data won&#8217;t need to be animated, and the samples are instead used as a frame
of reference.</p>
<p>Notice that in <code class="docutils literal"><span class="pre">mapping-file.txt</span></code> there are two columns that describe this
information. First, as the <em>gradient</em> category, we can use
<code class="docutils literal"><span class="pre">day_relative_to_fmt</span></code> (a column that describes the number of days before or
after the FMT), and as the <em>trajectory</em> category we can use <code class="docutils literal"><span class="pre">host_subject_id</span></code>
(a column with unique identifiers for each individual participating in both
studies).</p>
<p>One thing you will notice is that samples from the HMP lack a value for the
<code class="docutils literal"><span class="pre">day_relative_to_fmt</span></code> column, since these subjects did not undergo a
transplant. When we look at these samples, we observe that they are all labeled
with an <code class="docutils literal"><span class="pre">unknown</span></code> value. In order to use this information we will replace the
label <code class="docutils literal"><span class="pre">unknown</span></code> for a <code class="docutils literal"><span class="pre">0</span></code>, such that the mapping file passes Emperor&#8217;s
validations. You can do this using a spreadsheet manipulation program like
Excel, or alternatively you can use a scripting language like R or Python
(using Pandas is recommended) to perform these manipulations. After doing this,
we suggest that you create a new column that includes these modifications, and
name it <code class="docutils literal"><span class="pre">animations_gradient</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When plots are generated with Emperor, only columns where all values are
numeric can be animated as a <em>gradient</em> category. Trajectories with mixed
types or with non-numeric types will be ignored.</p>
</div>
<p>As for the <em>trajectory</em> category, we will ignore all subjects except the ones
that underwent a FMT, so for all other samples (both for the HMP and FMT), we
will set the <code class="docutils literal"><span class="pre">host_subject_id</span></code> value to <code class="docutils literal"><span class="pre">NA</span></code>. Again, we will create a new
column to store this modified information, and we will name it
<code class="docutils literal"><span class="pre">animations_subject</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The names of the columns can be arbitrarly chosen by the user, but we
recommend clearly distinguishing the purpose.</p>
</div>
<p>After you&#8217;ve done this, the result will be a new metadata mapping file that
includes two new columns, <code class="docutils literal"><span class="pre">animations_gradient</span></code> and <code class="docutils literal"><span class="pre">animations_subject</span></code>
(for an example see <code class="docutils literal"><span class="pre">mapping-file.animations.txt</span></code>). All that&#8217;s left is to
create the plot itself, to do that we will use <code class="docutils literal"><span class="pre">qiime</span> <span class="pre">emperor</span> <span class="pre">plot</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qiime</span> <span class="n">emperor</span> <span class="n">plot</span> <span class="o">--</span><span class="n">i</span><span class="o">-</span><span class="n">pcoa</span> <span class="n">unweighted</span><span class="o">-</span><span class="n">unifrac</span><span class="o">-</span><span class="n">pcoa</span><span class="o">.</span><span class="n">qza</span> <span class="o">--</span><span class="n">m</span><span class="o">-</span><span class="n">metadata</span><span class="o">-</span><span class="n">file</span> <span class="n">mapping</span><span class="o">-</span><span class="n">file</span><span class="o">.</span><span class="n">animations</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">o</span><span class="o">-</span><span class="n">visualization</span> <span class="n">unweighted</span><span class="o">-</span><span class="n">unifrac</span><span class="o">-</span><span class="n">pcoa</span><span class="o">.</span><span class="n">animations</span><span class="o">.</span><span class="n">qzv</span>
</pre></div>
</div>
<p>After you do this, you can open the plot, select <code class="docutils literal"><span class="pre">body_habitat</span></code> as a color
category (under the Colors tab). Now, go to the animations tab on the right.
Next, in the <em>Gradient Category</em> menu select <em>animations_gradient</em>, and in the
<em>Trajectory Category</em> menu select <em>animations_subject</em>. Now you can click the
play button and visualize the changes in the microbiome of the four patients.
As you do this, you can continue to interact with the plot, and change other
visual attributes.</p>
<p>The resulting plot can be found <a class="reference external" href="https://view.qiime2.org/visualization/?type=html&amp;src=https%3A%2F%2Fdl.dropbox.com%2Fs%2Fh8qw76loauepnkk%2Funweighted-unifrac-pcoa.animations.qzv%3Fdl%3D1">here</a>, please note that this plot
includes a few presets that will be different from the plot that you generated
above, however both plots are fundamentally the same.</p>
</div>
</div>
<div class="section" id="filtering-out-data">
<h2>Filtering out data<a class="headerlink" href="#filtering-out-data" title="Permalink to this headline">¶</a></h2>
<p>In some situations, we want to focus only one or a handful of the existing
trajectories in a dataset. In such a case, you can hide any trajectories you
want by creating a new column in your sample information, for example
<code class="docutils literal"><span class="pre">animation_one_trajectory</span></code>, and then setting the values of the samples that
you do not wish to see animated to <code class="docutils literal"><span class="pre">0</span></code>.</p>
<p>The idea above applies as well to blanks or other types of technical samples
that will not need to be animated.</p>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Emperor Development Team.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.<br/>
    </p>
  </div>
</footer>

  </body>
</html>